/*
  * CombinedReceiver.cpp
  *
  * Demonstrates receiving NEC protocol IR codes with IRremote and controlling LEDs based on 
  * specific Apple protocol commands.
 6.  * This file is part of Arduino-IRremote https://github.com/Arduino-IRremote/Arduino-IRremote.
 7.  */
 8.  
 9. #include <Arduino.h>
10. #include <IRremote.hpp> // Include the library
11.  
12. // Define IR_RECEIVE_PIN to correspond with Digital Pin 22
13. #define IR_RECEIVE_PIN 22
14.  
15. int RED = 10;      // Define pin for red LED
16. int GREEN = 11;    // Define pin for green LED
17.  
18. void setup() {
19.     Serial.begin(115200);
20.  
21.     // Notification on startup
22.     Serial.println(F("START " __FILE__ " from " __DATE__ "\r\nUsing library version " VERSION_IRREMOTE));
23.  
24.     // Start the IR receiver
25.     IrReceiver.begin(IR_RECEIVE_PIN, ENABLE_LED_FEEDBACK);
26.  
27.     Serial.print(F("Ready to receive IR signals of protocols: "));
28.     printActiveIRProtocols(&Serial);
29.     Serial.print(F(" at pin "));
30.     Serial.println(String(IR_RECEIVE_PIN));
31.  
32.     // Setup LED pins
33.     pinMode(RED, OUTPUT);
34.     pinMode(GREEN, OUTPUT);
35. }
36.  
37. void loop() {
38.     if (IrReceiver.decode()) {
39.         // Print a summary of received data
40.         if (IrReceiver.decodedIRData.protocol == UNKNOWN) {
41.             Serial.println(F("Received noise or unknown protocol"));
42.             IrReceiver.printIRResultRawFormatted(&Serial, true);
43.             IrReceiver.resume();
44.         } else {
45.             IrReceiver.resume(); // Enable receiving of the next IR frame
46.             IrReceiver.printIRResultShort(&Serial);
47.             IrReceiver.printIRSendUsage(&Serial);
48.             Serial.println();
49.  
50.             // Check received data and perform actions
51.             if (IrReceiver.decodedIRData.flags & IRDATA_FLAGS_IS_REPEAT) {
52.                 Serial.println(F("Repeat received. Here you can repeat the same action as before."));
53.             } else {
54.                 handleIRCommands();  // Call function without parameters
55.             }
56.         }
57.     }
58. }
59.  
60. void handleIRCommands() {
61.     // Check for the specific commands from the Apple protocol
62.     if (IrReceiver.decodedIRData.protocol == APPLE) {
63.         if (IrReceiver.decodedIRData.address == 0xF5 && IrReceiver.decodedIRData.command == 0xB) {
64.             Serial.println(F("Received Apple command 0xB with address 0xF5."));
65.             red_light();  // Turn on the red LED
66.         } else if (IrReceiver.decodedIRData.address == 0xF5 && IrReceiver.decodedIRData.command == 0xD) {
67.             Serial.println(F("Received Apple command 0xD with address 0xF5."));
68.             green_light();  // Turn on the green LED
69.         }
70.     }
71. }
72.  
73. void red_light() {  // A function for turning only the red LED on
74.     digitalWrite(GREEN, LOW);  // Turning off the green LED
75.     digitalWrite(RED, HIGH);    // Turning on the red LED
76. }
77.  
78. void green_light() {  // A function for turning only the green LED on
79.     digitalWrite(GREEN, HIGH);  // Turning on the green LED
80.     digitalWrite(RED, LOW);      // Turning off the red LED
81. }
82.  
83. void yellow_light() {  // A function for turning both LEDs on (if needed)
84.     digitalWrite(GREEN, HIGH); // Turning on the green LED
85.     digitalWrite(RED, HIGH);   // Turning on the red LED
86. }
